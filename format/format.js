window.storyFormat({
	name: "Harrow",
	description: "Harrow engine scene testing format.",
	version: "1.1.0",
	author: "Nayata",
	url: "https://github.com/nayata",
	license: "MIT",
	proofing: false,
	source: "<!DOCTYPE html>\r\n<html>\r\n\t<head>\r\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n\t\t<meta charset=\"utf-8\"/>\r\n\t\t<title>{{STORY_NAME}}</title>\r\n\t\t<style>\r\nhtml {\r\n\tdisplay: grid;\r\n\theight: 100%;\r\n\tfont-size: 100%;\r\n\tfont-size: 22px;\r\n}\r\n\r\nbody {\r\n\tcolor: rgba(50,50,50,1);\r\n\tfont-family: Georgia;\r\n\tbackground: #ffffff;\r\n\tbackground-image: linear-gradient(135deg, #f7f7f7, #ffffff); \r\n\ttransition: 0.5s background ease;\r\n\toverflow: auto;\r\n\tscroll-behavior: smooth;\r\n}\r\n\r\npage {\r\n\tdisplay: grid;\r\n\twidth: 32%;\r\n\theight: 96%;\r\n\tmin-width: 0;\r\n\tmin-height: 0;\r\n\twidth: 600px;\r\n\tgrid-template-rows: auto 1fr auto;\r\n\tgap: 8px;\r\n\tposition: absolute;\r\n\ttop: 0; bottom: 0; left: 0; right: 0;\r\n\tmargin: auto;\r\n\tborder-radius: 16px;\r\n\tbackground: #ffffff;\r\n}\r\n\r\n@media screen and (max-width: 600px) {\r\n\tpage {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tborder-radius: 0;\r\n\t}\r\n}\r\n\r\nheader {\r\n\tpadding: 2em 2em;\r\n\tcolor: var(--header);\r\n}\r\n\r\nheader hr {\r\n\tcolor: #444;\r\n\tborder: 1px solid #ffffff;\r\n\tborder-color: var(--header);\r\n\topacity: 0.9;\r\n}\r\n\r\narticle {\r\n\tpadding: 1em 2em;\r\n\toverflow: auto;\r\n\tscroll-behavior: smooth;\r\n\tcolor: #333333;\r\n}\r\n\r\nfooter {\r\n\tpadding: 1em;\r\n}\r\n\r\noptions {\r\n\tfloat: right;\r\n\tcursor: pointer;\r\n}\r\n\r\nh2 {\r\n\tfont-size: 1.75rem;\r\n\tmargin-top: 1.5rem;\r\n}\r\n\r\narticle p {\r\n\tfont-size: 1.2rem;\r\n\tline-height: 1.5;\r\n\tfont-weight: 500;\r\n\tmargin-top: 1.25rem;\r\n\tmax-width: 30em;\r\n}\r\n\r\nbutton {\r\n    padding: 20px 128px;\r\n    border-style: none;\r\n    border-radius: 10px;\r\n    font-family: Georgia, sans-serif;\r\n    font-weight: 500;\r\n    font-style: normal;\r\n    font-size: .875em;\r\n    line-height: 1.5;\r\n    color: #ececec;\r\n    background-color: #222222;\r\n    cursor: pointer;\r\n\tdisplay: block;\r\n\tmargin: 10px auto 0;\r\n\ttext-align: center;\r\n\twidth: 100%;\r\n}\r\n\r\nbutton::last-child {\r\n\tmargin: 10px auto 0;\r\n}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t{{STORY_DATA}}\r\n\t\t<page>\r\n\t\t<header>\r\n\t\t\t<chapter>Chapter</chapter>\r\n\t\t\t<options>Restart</options>\r\n\t\t</header>\r\n\t\t<article>\r\n\t\t</article>\r\n\t\t<footer>\r\n\t\t</footer>\r\n\t\t</page>\r\n\t\t\r\n\t</body>\r\n\r\n\t<script src=\"https://code.jquery.com/jquery-3.1.0.min.js\"></script>\r\n\t<script>\r\n// Generated by Haxe 4.3.4\r\n(function ($global) { \"use strict\";\r\nfunction $extend(from, fields) {\r\n\tvar proto = Object.create(from);\r\n\tfor (var name in fields) proto[name] = fields[name];\r\n\tif( fields.toString !== Object.prototype.toString ) proto.toString = fields.toString;\r\n\treturn proto;\r\n}\r\nvar App = function() {\r\n\tvar _gthis = this;\r\n\tvar storydata = window.document.querySelector(\"tw-storydata\");\r\n\tvar startnode = storydata.getAttribute(\"startnode\");\r\n\tvar source = storydata.children;\r\n\tvar entry = \"\";\r\n\tvar _g = 0;\r\n\twhile(_g < source.length) {\r\n\t\tvar route = source[_g];\r\n\t\t++_g;\r\n\t\tvar name = route.getAttribute(\"name\");\r\n\t\tvar pid = route.getAttribute(\"pid\");\r\n\t\tif(name != null) {\r\n\t\t\tentry += \"#\" + name + \"\\n\";\r\n\t\t\tif(pid == startnode) {\r\n\t\t\t\tstartnode = name;\r\n\t\t\t}\r\n\t\t\tvar content = route.innerHTML.split(\"\\n\");\r\n\t\t\tvar _g1 = 0;\r\n\t\t\twhile(_g1 < content.length) {\r\n\t\t\t\tvar line = content[_g1];\r\n\t\t\t\t++_g1;\r\n\t\t\t\tvar string = StringTools.trim(line);\r\n\t\t\t\tvar lead = string.substring(0,1);\r\n\t\t\t\tvar link = string.substring(0,2);\r\n\t\t\t\tif(lead == \"-\") {\r\n\t\t\t\t\tstring = StringTools.replace(string,\"[[\",\"\");\r\n\t\t\t\t\tstring = StringTools.replace(string,\"]]\",\"\");\r\n\t\t\t\t}\r\n\t\t\t\tif(link == \"[[\") {\r\n\t\t\t\t\tstring = StringTools.replace(string,\"[[\",\"\");\r\n\t\t\t\t\tstring = StringTools.replace(string,\"]]\",\"\");\r\n\t\t\t\t\tstring = \"[move \" + string + \"]\";\r\n\t\t\t\t}\r\n\t\t\t\tstring = StringTools.replace(string,\"&lt;\",\"<\");\r\n\t\t\t\tstring = StringTools.replace(string,\"&gt;\",\">\");\r\n\t\t\t\tentry += string + \"\\n\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tLibrary.COLON = \":\";\r\n\tthis.story = Library.get(entry);\r\n\tthis.story.move(startnode);\r\n\tthis.novel = new Runtime(this.story);\r\n\tthis.novel.onText = $bind(this,this.onText);\r\n\tthis.novel.onDialogue = $bind(this,this.onDialogue);\r\n\tthis.novel.onEnd = $bind(this,this.onEnd);\r\n\twindow.document.querySelector(\"chapter\").innerHTML = storydata.getAttribute(\"name\");\r\n\tthis.textbox = window.document.querySelector(\"article\");\r\n\tvar container = window.document.querySelector(\"footer\");\r\n\tthis.dialogue = window.document.createElement(\"div\");\r\n\tcontainer.appendChild(this.dialogue);\r\n\tthis.button = window.document.createElement(\"button\");\r\n\tcontainer.appendChild(this.button);\r\n\tthis.button.textContent = \"Continue\";\r\n\tthis.button.onclick = function(event) {\r\n\t\t_gthis.onClick();\r\n\t};\r\n\tvar restart = window.document.querySelector(\"options\");\r\n\trestart.onclick = function(event) {\r\n\t\t$global.location.reload();\r\n\t};\r\n\tthis.novel.nextPage();\r\n};\r\nApp.__name__ = true;\r\nApp.main = function() {\r\n\tApp.ME = new App();\r\n};\r\nApp.prototype = {\r\n\tonClick: function() {\r\n\t\tthis.button.style.display = \"none\";\r\n\t\tthis.novel.nextPage();\r\n\t}\r\n\t,onText: function(text,name) {\r\n\t\tthis.textbox.innerHTML = \"<p>\" + text + \"</p>\";\r\n\t\tthis.textbox.style.opacity = \"0\";\r\n\t\t$(this.textbox).fadeTo(300,1);\r\n\t\tthis.button.style.display = \"block\";\r\n\t}\r\n\t,onDialogue: function(choices) {\r\n\t\tvar _gthis = this;\r\n\t\tvar _g = 0;\r\n\t\twhile(_g < choices.length) {\r\n\t\t\tvar entry = [choices[_g]];\r\n\t\t\t++_g;\r\n\t\t\tvar choice = window.document.createElement(\"button\");\r\n\t\t\tchoice.textContent = entry[0].text;\r\n\t\t\tchoice.className = \"choice\";\r\n\t\t\tchoice.onclick = (function(entry) {\r\n\t\t\t\treturn function(event) {\r\n\t\t\t\t\t_gthis.onSelect(entry[0].type,entry[0].data);\r\n\t\t\t\t};\r\n\t\t\t})(entry);\r\n\t\t\tthis.dialogue.appendChild(choice);\r\n\t\t}\r\n\t}\r\n\t,onSelect: function(type,data) {\r\n\t\tthis.textbox.innerHTML = \"\";\r\n\t\tthis.dialogue.innerHTML = \"\";\r\n\t\tthis.novel.onChoice(type,data);\r\n\t}\r\n\t,onEnd: function() {\r\n\t\tthis.textbox.innerHTML = \"<p>Story End</p>\";\r\n\t\t$(this.textbox).fadeTo(300,1);\r\n\t}\r\n};\r\nvar EReg = function(r,opt) {\r\n\tthis.r = new RegExp(r,opt.split(\"u\").join(\"\"));\r\n};\r\nEReg.__name__ = true;\r\nEReg.prototype = {\r\n\tmatch: function(s) {\r\n\t\tif(this.r.global) {\r\n\t\t\tthis.r.lastIndex = 0;\r\n\t\t}\r\n\t\tthis.r.m = this.r.exec(s);\r\n\t\tthis.r.s = s;\r\n\t\treturn this.r.m != null;\r\n\t}\r\n\t,matched: function(n) {\r\n\t\tif(this.r.m != null && n >= 0 && n < this.r.m.length) {\r\n\t\t\treturn this.r.m[n];\r\n\t\t} else {\r\n\t\t\tthrow haxe_Exception.thrown(\"EReg::matched\");\r\n\t\t}\r\n\t}\r\n\t,matchedPos: function() {\r\n\t\tif(this.r.m == null) {\r\n\t\t\tthrow haxe_Exception.thrown(\"No string matched\");\r\n\t\t}\r\n\t\treturn { pos : this.r.m.index, len : this.r.m[0].length};\r\n\t}\r\n\t,matchSub: function(s,pos,len) {\r\n\t\tif(len == null) {\r\n\t\t\tlen = -1;\r\n\t\t}\r\n\t\tif(this.r.global) {\r\n\t\t\tthis.r.lastIndex = pos;\r\n\t\t\tthis.r.m = this.r.exec(len < 0 ? s : HxOverrides.substr(s,0,pos + len));\r\n\t\t\tvar b = this.r.m != null;\r\n\t\t\tif(b) {\r\n\t\t\t\tthis.r.s = s;\r\n\t\t\t}\r\n\t\t\treturn b;\r\n\t\t} else {\r\n\t\t\tvar b = this.match(len < 0 ? HxOverrides.substr(s,pos,null) : HxOverrides.substr(s,pos,len));\r\n\t\t\tif(b) {\r\n\t\t\t\tthis.r.s = s;\r\n\t\t\t\tthis.r.m.index += pos;\r\n\t\t\t}\r\n\t\t\treturn b;\r\n\t\t}\r\n\t}\r\n\t,map: function(s,f) {\r\n\t\tvar offset = 0;\r\n\t\tvar buf_b = \"\";\r\n\t\tdo {\r\n\t\t\tif(offset >= s.length) {\r\n\t\t\t\tbreak;\r\n\t\t\t} else if(!this.matchSub(s,offset)) {\r\n\t\t\t\tbuf_b += Std.string(HxOverrides.substr(s,offset,null));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar p = this.matchedPos();\r\n\t\t\tbuf_b += Std.string(HxOverrides.substr(s,offset,p.pos - offset));\r\n\t\t\tbuf_b += Std.string(f(this));\r\n\t\t\tif(p.len == 0) {\r\n\t\t\t\tbuf_b += Std.string(HxOverrides.substr(s,p.pos,1));\r\n\t\t\t\toffset = p.pos + 1;\r\n\t\t\t} else {\r\n\t\t\t\toffset = p.pos + p.len;\r\n\t\t\t}\r\n\t\t} while(this.r.global);\r\n\t\tif(!this.r.global && offset > 0 && offset < s.length) {\r\n\t\t\tbuf_b += Std.string(HxOverrides.substr(s,offset,null));\r\n\t\t}\r\n\t\treturn buf_b;\r\n\t}\r\n};\r\nvar HxOverrides = function() { };\r\nHxOverrides.__name__ = true;\r\nHxOverrides.cca = function(s,index) {\r\n\tvar x = s.charCodeAt(index);\r\n\tif(x != x) {\r\n\t\treturn undefined;\r\n\t}\r\n\treturn x;\r\n};\r\nHxOverrides.substr = function(s,pos,len) {\r\n\tif(len == null) {\r\n\t\tlen = s.length;\r\n\t} else if(len < 0) {\r\n\t\tif(pos == 0) {\r\n\t\t\tlen = s.length + len;\r\n\t\t} else {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t}\r\n\treturn s.substr(pos,len);\r\n};\r\nHxOverrides.now = function() {\r\n\treturn Date.now();\r\n};\r\nMath.__name__ = true;\r\nvar Std = function() { };\r\nStd.__name__ = true;\r\nStd.string = function(s) {\r\n\treturn js_Boot.__string_rec(s,\"\");\r\n};\r\nStd.parseInt = function(x) {\r\n\tvar v = parseInt(x);\r\n\tif(isNaN(v)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn v;\r\n};\r\nvar StringTools = function() { };\r\nStringTools.__name__ = true;\r\nStringTools.isSpace = function(s,pos) {\r\n\tvar c = HxOverrides.cca(s,pos);\r\n\tif(!(c > 8 && c < 14)) {\r\n\t\treturn c == 32;\r\n\t} else {\r\n\t\treturn true;\r\n\t}\r\n};\r\nStringTools.ltrim = function(s) {\r\n\tvar l = s.length;\r\n\tvar r = 0;\r\n\twhile(r < l && StringTools.isSpace(s,r)) ++r;\r\n\tif(r > 0) {\r\n\t\treturn HxOverrides.substr(s,r,l - r);\r\n\t} else {\r\n\t\treturn s;\r\n\t}\r\n};\r\nStringTools.rtrim = function(s) {\r\n\tvar l = s.length;\r\n\tvar r = 0;\r\n\twhile(r < l && StringTools.isSpace(s,l - r - 1)) ++r;\r\n\tif(r > 0) {\r\n\t\treturn HxOverrides.substr(s,0,l - r);\r\n\t} else {\r\n\t\treturn s;\r\n\t}\r\n};\r\nStringTools.trim = function(s) {\r\n\treturn StringTools.ltrim(StringTools.rtrim(s));\r\n};\r\nStringTools.replace = function(s,sub,by) {\r\n\treturn s.split(sub).join(by);\r\n};\r\nvar Choice = function() {\r\n\tthis.role = \"empty\";\r\n\tthis.data = \"empty\";\r\n\tthis.text = \"empty\";\r\n\tthis.type = \"empty\";\r\n};\r\nChoice.__name__ = true;\r\nvar Dialogue = function() { };\r\nDialogue.__name__ = true;\r\nDialogue.get = function(entry) {\r\n\tvar map = entry.split(Library.LINE);\r\n\tvar choices = [];\r\n\tvar _g = 0;\r\n\tvar _g1 = map.length;\r\n\twhile(_g < _g1) {\r\n\t\tvar i = _g++;\r\n\t\tvar key = map[i].split(Library.ITEM);\r\n\t\tvar choice = new Choice();\r\n\t\tchoice.text = key[0];\r\n\t\tchoice.type = key[1];\r\n\t\tchoice.data = key[2];\r\n\t\tchoice.role = key[3];\r\n\t\tchoices.push(choice);\r\n\t}\r\n\treturn choices;\r\n};\r\nvar Format = function() { };\r\nFormat.__name__ = true;\r\nFormat.variable = function(entry) {\r\n\tif(entry.indexOf(\"[\") == -1) {\r\n\t\treturn entry;\r\n\t}\r\n\tvar rex = new EReg(\"\\\\[(.*?)\\\\]\",\"gi\");\r\n\tentry = rex.map(entry,function(r) {\r\n\t\tvar matching = r.matched(0);\r\n\t\tvar variable = matching.substring(1,matching.length - 1);\r\n\t\tif(Storage.has(variable)) {\r\n\t\t\treturn Storage.get(variable);\r\n\t\t}\r\n\t\treturn matching;\r\n\t});\r\n\treturn entry;\r\n};\r\nvar Library = function() { };\r\nLibrary.__name__ = true;\r\nLibrary.get = function(entry) {\r\n\tvar res = entry.split(Library.LF);\r\n\tvar story = new Story();\r\n\tvar line = 0;\r\n\twhile(line < res.length) {\r\n\t\tvar node = Library.getNode(res,line);\r\n\t\tif(node != null && node.type != Library.EMPTY) {\r\n\t\t\tvar page = new Page();\r\n\t\t\tpage.type = node.type;\r\n\t\t\tpage.text = node.text;\r\n\t\t\tpage.data = node.data;\r\n\t\t\tstory.data.push(page);\r\n\t\t\tline += node.depth;\r\n\t\t}\r\n\t\t++line;\r\n\t}\r\n\treturn story;\r\n};\r\nLibrary.getNode = function(res,page) {\r\n\tvar string = StringTools.trim(res[page]);\r\n\tif(string.length == 0) {\r\n\t\treturn null;\r\n\t}\r\n\tvar node = new Node();\r\n\tvar type = \"text\";\r\n\tvar leading = string.substring(0,1);\r\n\tif(leading == \"#\") {\r\n\t\ttype = \"route\";\r\n\t}\r\n\tif(leading == \":\") {\r\n\t\ttype = \"label\";\r\n\t}\r\n\tif(leading == \"-\") {\r\n\t\ttype = \"dialogue\";\r\n\t}\r\n\tif(leading == \"[\") {\r\n\t\ttype = Library.isEvent(string);\r\n\t}\r\n\tif(leading == \"/\") {\r\n\t\ttype = Library.EMPTY;\r\n\t}\r\n\tif(Library.isBreak(string)) {\r\n\t\ttype = \"break\";\r\n\t}\r\n\tnode.type = type;\r\n\tif(type == \"text\") {\r\n\t\tLibrary.getText(node,string);\r\n\t}\r\n\tif(type == \"label\") {\r\n\t\tvar label = StringTools.replace(string,\":\",\"\");\r\n\t\tnode.text = StringTools.trim(label);\r\n\t}\r\n\tif(type == \"route\") {\r\n\t\tvar route = StringTools.replace(string,\"#\",\"\");\r\n\t\tnode.text = StringTools.trim(route);\r\n\t}\r\n\tif(type == \"dialogue\") {\r\n\t\tLibrary.getDialogue(node,res,page);\r\n\t}\r\n\tif(type == \"event\") {\r\n\t\tLibrary.getEvent(node,string);\r\n\t}\r\n\treturn node;\r\n};\r\nLibrary.getText = function(node,res) {\r\n\tvar raw = StringTools.replace(res,Library.COLON,Library.LINE);\r\n\tvar key = raw.split(Library.KEY);\r\n\tnode.text = StringTools.trim(key.pop());\r\n\tnode.text = StringTools.replace(node.text,Library.LINE,Library.KEY);\r\n\tnode.data = key.length > 0 ? StringTools.trim(key[Library.TYPE]) : \"\";\r\n};\r\nLibrary.getDialogue = function(node,res,indent) {\r\n\tvar dialogue = [];\r\n\tvar _g = indent;\r\n\tvar _g1 = res.length;\r\n\twhile(_g < _g1) {\r\n\t\tvar page = _g++;\r\n\t\tvar sampled = StringTools.trim(res[page]);\r\n\t\tvar allowed = sampled.substring(0,2) != Library.DASH + Library.DASH;\r\n\t\tvar leading = sampled.substring(0,1);\r\n\t\tif(leading == Library.DASH && allowed) {\r\n\t\t\tdialogue.push(res[page]);\r\n\t\t} else {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tvar content = \"\";\r\n\tvar string = \"\";\r\n\tvar _g = 0;\r\n\tvar _g1 = dialogue.length;\r\n\twhile(_g < _g1) {\r\n\t\tvar i = _g++;\r\n\t\tstring = dialogue[i];\r\n\t\tstring = StringTools.replace(string,Library.DASH,\"\");\r\n\t\tstring = Library.getDialogueItem(string);\r\n\t\tvar divider = Library.LINE;\r\n\t\tif(i == dialogue.length - 1) {\r\n\t\t\tdivider = \"\";\r\n\t\t}\r\n\t\tcontent = content + string + divider;\r\n\t}\r\n\tnode.text = content;\r\n\tnode.depth = dialogue.length - 1;\r\n};\r\nLibrary.getDialogueItem = function(res) {\r\n\tvar key = res.split(Library.KEY);\r\n\tvar text = StringTools.trim(key[Library.TYPE]);\r\n\tvar type = \"empty\";\r\n\tvar data = \"empty\";\r\n\tvar role = \"empty\";\r\n\tif(key.length > 1) {\r\n\t\tvar string = StringTools.trim(key[Library.TEXT]);\r\n\t\tstring = StringTools.replace(string,Library.SPACE,Library.KEY);\r\n\t\tvar prop = string.split(Library.KEY);\r\n\t\tif(Library.isVariable(prop[Library.TEXT])) {\r\n\t\t\ttype = \"variable\";\r\n\t\t\tdata = string;\r\n\t\t} else {\r\n\t\t\ttype = \"route\";\r\n\t\t\tdata = StringTools.trim(key[Library.TEXT]);\r\n\t\t}\r\n\t}\r\n\tif(key.length > 2) {\r\n\t\trole = StringTools.trim(key[Library.DATA]);\r\n\t\trole = StringTools.replace(role,Library.SPACE,Library.KEY);\r\n\t}\r\n\treturn text + Library.ITEM + type + Library.ITEM + data + Library.ITEM + role;\r\n};\r\nLibrary.getEvent = function(node,res) {\r\n\tvar string = res.substring(1,res.length - 1);\r\n\tstring = StringTools.trim(string);\r\n\tstring = StringTools.replace(string,Library.COMA + Library.SPACE,Library.COMA);\r\n\tstring = StringTools.replace(string,Library.SPACE + Library.SPACE,Library.KEY);\r\n\tstring = StringTools.replace(string,Library.SPACE,Library.KEY);\r\n\tvar key = string.split(Library.KEY);\r\n\tvar type = key[Library.TYPE];\r\n\tnode.type = \"event\";\r\n\tnode.text = StringTools.replace(string,type + \":\",\"\");\r\n\tnode.data = type;\r\n\tif(type == \"move\") {\r\n\t\tnode.type = \"move\";\r\n\t\tnode.text = StringTools.replace(string,\"move:\",\"\");\r\n\t\tnode.text = StringTools.replace(node.text,Library.KEY,Library.SPACE);\r\n\t}\r\n\tif(type == \"story\") {\r\n\t\tnode.type = \"move\";\r\n\t\tnode.text = StringTools.replace(string,\"story:\",\"\");\r\n\t\tnode.text = StringTools.replace(node.text,Library.KEY,Library.SPACE);\r\n\t}\r\n\tif(type == \"lock\") {\r\n\t\tnode.type = \"move\";\r\n\t\tnode.text = type;\r\n\t}\r\n\tif(type == \"if\") {\r\n\t\tnode.type = \"condition\";\r\n\t\tnode.text = StringTools.replace(string,\"if:\",\"\");\r\n\t}\r\n\tif(type == \"else\" || type == \"end\") {\r\n\t\tnode.type = \"condition\";\r\n\t\tnode.text = type;\r\n\t}\r\n\tif(Library.isVariable(key[Library.TEXT])) {\r\n\t\tnode.type = \"variable\";\r\n\t\tnode.text = string;\r\n\t}\r\n};\r\nLibrary.isBreak = function(entry) {\r\n\tvar leading = entry.substring(0,2);\r\n\tif(leading == Library.DASH + Library.DASH) {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\nLibrary.isEvent = function(entry) {\r\n\tif(entry.indexOf(\"]\") != entry.length - 1) {\r\n\t\treturn \"text\";\r\n\t}\r\n\treturn \"event\";\r\n};\r\nLibrary.isVariable = function(entry) {\r\n\tif(entry == \"=\" || entry == \"+\" || entry == \"-\" || entry == \"*\" || entry == \"/\") {\r\n\t\treturn true;\r\n\t}\r\n\tif(entry == \"roll\" || entry == \"chance\" || entry == \"delete\") {\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n};\r\nvar Node = function() {\r\n\tthis.depth = 0;\r\n\tthis.data = \"\";\r\n\tthis.text = \"\";\r\n\tthis.type = \"\";\r\n};\r\nNode.__name__ = true;\r\nvar Random = function() {\r\n};\r\nRandom.__name__ = true;\r\nRandom.prototype = {\r\n\tchance: function(entry) {\r\n\t\treturn this.roll(0,100) < Std.parseInt(entry);\r\n\t}\r\n\t,dice: function(entry) {\r\n\t\treturn this.roll(1,Std.parseInt(entry));\r\n\t}\r\n\t,roll: function(min,max) {\r\n\t\treturn min + Math.floor((max - min + 1) * Math.random());\r\n\t}\r\n};\r\nvar Logic = function() { };\r\nLogic.__name__ = true;\r\nLogic.variable = function(entry) {\r\n\tvar key = entry.split(Library.KEY);\r\n\tvar name = key.shift();\r\n\tvar type = key.shift();\r\n\tvar prop = key.join(Library.SPACE);\r\n\tif(type != null) {\r\n\t\tswitch(type) {\r\n\t\tcase \"*\":\r\n\t\t\tvar a = parseFloat(Logic.get(name));\r\n\t\t\tvar b = parseFloat(Logic.get(prop));\r\n\t\t\tLogic.set(name,Std.string(a * b));\r\n\t\t\tbreak;\r\n\t\tcase \"+\":\r\n\t\t\tvar a = parseFloat(Logic.get(name));\r\n\t\t\tvar b = parseFloat(Logic.get(prop));\r\n\t\t\tLogic.set(name,Std.string(a + b));\r\n\t\t\tbreak;\r\n\t\tcase \"-\":\r\n\t\t\tvar a = parseFloat(Logic.get(name));\r\n\t\t\tvar b = parseFloat(Logic.get(prop));\r\n\t\t\tLogic.set(name,Std.string(a - b));\r\n\t\t\tbreak;\r\n\t\tcase \"/\":\r\n\t\t\tvar a = parseFloat(Logic.get(name));\r\n\t\t\tvar b = parseFloat(Logic.get(prop));\r\n\t\t\tLogic.set(name,Std.string(a / b));\r\n\t\t\tbreak;\r\n\t\tcase \"=\":\r\n\t\t\tLogic.set(name,Logic.get(prop));\r\n\t\t\tbreak;\r\n\t\tcase \"chance\":\r\n\t\t\tvar prob = Logic.random.chance(Logic.get(prop));\r\n\t\t\tLogic.set(name,prob == null ? \"null\" : \"\" + prob);\r\n\t\t\tbreak;\r\n\t\tcase \"roll\":\r\n\t\t\tvar roll = Logic.random.dice(Logic.get(prop));\r\n\t\t\tLogic.set(name,roll == null ? \"null\" : \"\" + roll);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t}\r\n\t}\r\n};\r\nLogic.condition = function(entry) {\r\n\tif(entry == \"else\") {\r\n\t\treturn false;\r\n\t}\r\n\tif(entry == \"end\") {\r\n\t\treturn true;\r\n\t}\r\n\tvar key = entry.split(Library.KEY);\r\n\tvar name = key.shift();\r\n\tvar type = key.shift();\r\n\tvar prop = key.join(Library.SPACE);\r\n\tvar result = false;\r\n\tif(type != null) {\r\n\t\tswitch(type) {\r\n\t\tcase \"<\":\r\n\t\t\tvar a = parseFloat(Logic.get(name));\r\n\t\t\tvar b = parseFloat(Logic.get(prop));\r\n\t\t\tresult = a < b;\r\n\t\t\tbreak;\r\n\t\tcase \"=\":\r\n\t\t\tresult = Logic.get(name) == Logic.get(prop);\r\n\t\t\tbreak;\r\n\t\tcase \">\":\r\n\t\t\tvar a = parseFloat(Logic.get(name));\r\n\t\t\tvar b = parseFloat(Logic.get(prop));\r\n\t\t\tresult = a > b;\r\n\t\t\tbreak;\r\n\t\tcase \"chance\":\r\n\t\t\tresult = Logic.random.chance(Logic.get(prop));\r\n\t\t\tbreak;\r\n\t\tcase \"is\":\r\n\t\t\tresult = Logic.get(name) == Logic.get(prop);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n};\r\nLogic.get = function(entry) {\r\n\tif(entry == \"false\" || entry == \"true\") {\r\n\t\treturn entry;\r\n\t}\r\n\tif(Storage.has(entry)) {\r\n\t\treturn Storage.get(entry);\r\n\t}\r\n\treturn entry;\r\n};\r\nLogic.set = function(entry,value) {\r\n\tStorage.set(entry,value);\r\n};\r\nvar Page = function() {\r\n\tthis.data = \"\";\r\n\tthis.text = \"\";\r\n\tthis.type = \"\";\r\n};\r\nPage.__name__ = true;\r\nvar Runtime = function(entry) {\r\n\tthis.story = entry;\r\n};\r\nRuntime.__name__ = true;\r\nRuntime.prototype = {\r\n\tnextPage: function() {\r\n\t\tif(this.story.get_end()) {\r\n\t\t\tthis.onEnd();\r\n\t\t}\r\n\t\tif(this.story.get_end()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.page = this.story.next();\r\n\t\tthis.onPage(this.page);\r\n\t\tswitch(this.page.type) {\r\n\t\tcase \"condition\":\r\n\t\t\tvar condition = Logic.condition(this.page.text);\r\n\t\t\tif(condition == false) {\r\n\t\t\t\tthis.story.skip();\r\n\t\t\t}\r\n\t\t\tthis.nextPage();\r\n\t\t\tbreak;\r\n\t\tcase \"dialogue\":\r\n\t\t\tvar dialogue = Dialogue.get(this.page.text);\r\n\t\t\tvar _g = 0;\r\n\t\t\twhile(_g < dialogue.length) {\r\n\t\t\t\tvar choice = dialogue[_g];\r\n\t\t\t\t++_g;\r\n\t\t\t\tchoice.text = Format.variable(choice.text);\r\n\t\t\t}\r\n\t\t\tthis.onDialogue(dialogue);\r\n\t\t\tbreak;\r\n\t\tcase \"event\":\r\n\t\t\tthis.gameEvent();\r\n\t\t\tbreak;\r\n\t\tcase \"label\":\r\n\t\t\tbreak;\r\n\t\tcase \"move\":\r\n\t\t\tif(this.page.data == \"story\") {\r\n\t\t\t\tthis.onStory(this.page.text);\r\n\t\t\t}\r\n\t\t\tif(this.page.data == \"move\") {\r\n\t\t\t\tthis.story.move(this.page.text);\r\n\t\t\t\tthis.nextPage();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"route\":\r\n\t\t\tbreak;\r\n\t\tcase \"text\":\r\n\t\t\tvar text = Format.variable(this.page.text);\r\n\t\t\tthis.onText(text,this.page.data);\r\n\t\t\tbreak;\r\n\t\tcase \"variable\":\r\n\t\t\tLogic.variable(this.page.text);\r\n\t\t\tthis.nextPage();\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t}\r\n\t}\r\n\t,gameEvent: function() {\r\n\t\tswitch(this.page.data) {\r\n\t\tcase \"transition\":\r\n\t\t\tthis.onTransition();\r\n\t\t\tbreak;\r\n\t\tcase \"wait\":\r\n\t\t\tvar time = Std.parseInt(this.page.text);\r\n\t\t\thaxe_Timer.delay($bind(this,this.nextPage),time * 60);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.onEvent(this.page.data,this.page.text);\r\n\t\t\tthis.nextPage();\r\n\t\t}\r\n\t}\r\n\t,onChoice: function(type,data) {\r\n\t\tif(type == \"route\") {\r\n\t\t\tthis.story.move(data);\r\n\t\t}\r\n\t\tif(type == \"variable\") {\r\n\t\t\tLogic.variable(data);\r\n\t\t}\r\n\t\tthis.nextPage();\r\n\t}\r\n\t,onPage: function(page) {\r\n\t}\r\n\t,onText: function(text,name) {\r\n\t}\r\n\t,onDialogue: function(dialogue) {\r\n\t}\r\n\t,onEvent: function(type,data) {\r\n\t}\r\n\t,onTransition: function() {\r\n\t}\r\n\t,onStory: function(name) {\r\n\t}\r\n\t,onEnd: function() {\r\n\t}\r\n};\r\nvar haxe_ds_StringMap = function() {\r\n\tthis.h = Object.create(null);\r\n};\r\nhaxe_ds_StringMap.__name__ = true;\r\nvar Storage = function() { };\r\nStorage.__name__ = true;\r\nStorage.get = function(key) {\r\n\treturn Storage.variable.h[key];\r\n};\r\nStorage.set = function(key,value) {\r\n\tStorage.variable.h[key] = value;\r\n};\r\nStorage.has = function(key) {\r\n\treturn Object.prototype.hasOwnProperty.call(Storage.variable.h,key);\r\n};\r\nvar Story = function() {\r\n\tthis.page = -1;\r\n\tthis.data = [];\r\n};\r\nStory.__name__ = true;\r\nStory.prototype = {\r\n\tnext: function() {\r\n\t\tif(this.page < this.data.length) {\r\n\t\t\tthis.page += 1;\r\n\t\t}\r\n\t\treturn this.data[this.page];\r\n\t}\r\n\t,move: function(route) {\r\n\t\tvar _g = 0;\r\n\t\tvar _g1 = this.data.length;\r\n\t\twhile(_g < _g1) {\r\n\t\t\tvar i = _g++;\r\n\t\t\tif(this.data[i].type == \"route\" && this.data[i].text == route) {\r\n\t\t\t\treturn this.page = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.page;\r\n\t}\r\n\t,skip: function() {\r\n\t\tvar position = this.page + 1;\r\n\t\tvar _g = position;\r\n\t\tvar _g1 = this.data.length;\r\n\t\twhile(_g < _g1) {\r\n\t\t\tvar i = _g++;\r\n\t\t\tif(this.data[i].type == \"condition\") {\r\n\t\t\t\tif(this.data[i].text == \"end\" || this.data[i].text == \"else\") {\r\n\t\t\t\t\treturn this.page = i;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.page;\r\n\t}\r\n\t,get_end: function() {\r\n\t\treturn this.page == this.data.length - 1;\r\n\t}\r\n};\r\nvar haxe_Exception = function(message,previous,native) {\r\n\tError.call(this,message);\r\n\tthis.message = message;\r\n\tthis.__previousException = previous;\r\n\tthis.__nativeException = native != null ? native : this;\r\n};\r\nhaxe_Exception.__name__ = true;\r\nhaxe_Exception.thrown = function(value) {\r\n\tif(((value) instanceof haxe_Exception)) {\r\n\t\treturn value.get_native();\r\n\t} else if(((value) instanceof Error)) {\r\n\t\treturn value;\r\n\t} else {\r\n\t\tvar e = new haxe_ValueException(value);\r\n\t\treturn e;\r\n\t}\r\n};\r\nhaxe_Exception.__super__ = Error;\r\nhaxe_Exception.prototype = $extend(Error.prototype,{\r\n\tget_native: function() {\r\n\t\treturn this.__nativeException;\r\n\t}\r\n});\r\nvar haxe_Timer = function(time_ms) {\r\n\tvar me = this;\r\n\tthis.id = setInterval(function() {\r\n\t\tme.run();\r\n\t},time_ms);\r\n};\r\nhaxe_Timer.__name__ = true;\r\nhaxe_Timer.delay = function(f,time_ms) {\r\n\tvar t = new haxe_Timer(time_ms);\r\n\tt.run = function() {\r\n\t\tt.stop();\r\n\t\tf();\r\n\t};\r\n\treturn t;\r\n};\r\nhaxe_Timer.prototype = {\r\n\tstop: function() {\r\n\t\tif(this.id == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tclearInterval(this.id);\r\n\t\tthis.id = null;\r\n\t}\r\n\t,run: function() {\r\n\t}\r\n};\r\nvar haxe_ValueException = function(value,previous,native) {\r\n\thaxe_Exception.call(this,String(value),previous,native);\r\n\tthis.value = value;\r\n};\r\nhaxe_ValueException.__name__ = true;\r\nhaxe_ValueException.__super__ = haxe_Exception;\r\nhaxe_ValueException.prototype = $extend(haxe_Exception.prototype,{\r\n});\r\nvar haxe_iterators_ArrayIterator = function(array) {\r\n\tthis.current = 0;\r\n\tthis.array = array;\r\n};\r\nhaxe_iterators_ArrayIterator.__name__ = true;\r\nhaxe_iterators_ArrayIterator.prototype = {\r\n\thasNext: function() {\r\n\t\treturn this.current < this.array.length;\r\n\t}\r\n\t,next: function() {\r\n\t\treturn this.array[this.current++];\r\n\t}\r\n};\r\nvar js_Boot = function() { };\r\njs_Boot.__name__ = true;\r\njs_Boot.__string_rec = function(o,s) {\r\n\tif(o == null) {\r\n\t\treturn \"null\";\r\n\t}\r\n\tif(s.length >= 5) {\r\n\t\treturn \"<...>\";\r\n\t}\r\n\tvar t = typeof(o);\r\n\tif(t == \"function\" && (o.__name__ || o.__ename__)) {\r\n\t\tt = \"object\";\r\n\t}\r\n\tswitch(t) {\r\n\tcase \"function\":\r\n\t\treturn \"<function>\";\r\n\tcase \"object\":\r\n\t\tif(((o) instanceof Array)) {\r\n\t\t\tvar str = \"[\";\r\n\t\t\ts += \"\\t\";\r\n\t\t\tvar _g = 0;\r\n\t\t\tvar _g1 = o.length;\r\n\t\t\twhile(_g < _g1) {\r\n\t\t\t\tvar i = _g++;\r\n\t\t\t\tstr += (i > 0 ? \",\" : \"\") + js_Boot.__string_rec(o[i],s);\r\n\t\t\t}\r\n\t\t\tstr += \"]\";\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\tvar tostr;\r\n\t\ttry {\r\n\t\t\ttostr = o.toString;\r\n\t\t} catch( _g ) {\r\n\t\t\treturn \"???\";\r\n\t\t}\r\n\t\tif(tostr != null && tostr != Object.toString && typeof(tostr) == \"function\") {\r\n\t\t\tvar s2 = o.toString();\r\n\t\t\tif(s2 != \"[object Object]\") {\r\n\t\t\t\treturn s2;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar str = \"{\\n\";\r\n\t\ts += \"\\t\";\r\n\t\tvar hasp = o.hasOwnProperty != null;\r\n\t\tvar k = null;\r\n\t\tfor( k in o ) {\r\n\t\tif(hasp && !o.hasOwnProperty(k)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif(k == \"prototype\" || k == \"__class__\" || k == \"__super__\" || k == \"__interfaces__\" || k == \"__properties__\") {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tif(str.length != 2) {\r\n\t\t\tstr += \", \\n\";\r\n\t\t}\r\n\t\tstr += s + k + \" : \" + js_Boot.__string_rec(o[k],s);\r\n\t\t}\r\n\t\ts = s.substring(1);\r\n\t\tstr += \"\\n\" + s + \"}\";\r\n\t\treturn str;\r\n\tcase \"string\":\r\n\t\treturn o;\r\n\tdefault:\r\n\t\treturn String(o);\r\n\t}\r\n};\r\nvar $_;\r\nfunction $bind(o,m) { if( m == null ) return null; if( m.__id__ == null ) m.__id__ = $global.$haxeUID++; var f; if( o.hx__closures__ == null ) o.hx__closures__ = {}; else f = o.hx__closures__[m.__id__]; if( f == null ) { f = m.bind(o); o.hx__closures__[m.__id__] = f; } return f; }\r\n$global.$haxeUID |= 0;\r\nif(typeof(performance) != \"undefined\" ? typeof(performance.now) == \"function\" : false) {\r\n\tHxOverrides.now = performance.now.bind(performance);\r\n}\r\nString.__name__ = true;\r\nArray.__name__ = true;\r\njs_Boot.__toStr = ({ }).toString;\r\nLibrary.LF = \"\\n\";\r\nLibrary.EMPTY = \"\";\r\nLibrary.SPACE = \" \";\r\nLibrary.COLON = \"::\";\r\nLibrary.LINE = \"|\";\r\nLibrary.ITEM = \"::\";\r\nLibrary.COMA = \",\";\r\nLibrary.DASH = \"-\";\r\nLibrary.KEY = \":\";\r\nLibrary.TYPE = 0;\r\nLibrary.TEXT = 1;\r\nLibrary.DATA = 2;\r\nLogic.random = new Random();\r\nStorage.variable = new haxe_ds_StringMap();\r\nApp.main();\r\n})(typeof window != \"undefined\" ? window : typeof global != \"undefined\" ? global : typeof self != \"undefined\" ? self : this);\r\n\t</script>\r\n</html>"
})